{
  "openapi": "3.0.3",
  "info": {
    "title": "Compliance Master API",
    "description": "AI-powered document processing and ISO template generation for watsonx Orchestrate",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "http://localhost:8765",
      "description": "Local development server"
    }
  ],
  "paths": {
    "/health": {
      "get": {
        "operationId": "healthCheck",
        "summary": "Health check",
        "description": "Check if the API is running and healthy",
        "tags": ["System"],
        "responses": {
          "200": {
            "description": "API is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "healthy"
                    },
                    "version": {
                      "type": "string",
                      "example": "1.0.0"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/list-preloaded-documents": {
      "get": {
        "operationId": "listPreloadedDocuments",
        "summary": "List available sample documents",
        "description": "Get a list of all pre-loaded sample documents available for processing",
        "tags": ["Complete Processing"],
        "responses": {
          "200": {
            "description": "List of available documents",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "available_documents": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "document_id": {
                            "type": "string",
                            "example": "non_compliant_iso"
                          },
                          "description": {
                            "type": "string"
                          },
                          "filename": {
                            "type": "string"
                          }
                        }
                      }
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/process-preloaded": {
      "post": {
        "operationId": "processPreloaded",
        "summary": "Process pre-loaded document (RECOMMENDED for Orchestrate)",
        "description": "Process a pre-loaded sample document by ID - no file upload needed! Perfect for watsonx Orchestrate.",
        "tags": ["Complete Processing"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["document_id"],
                "properties": {
                  "document_id": {
                    "type": "string",
                    "description": "ID of pre-loaded document",
                    "example": "non_compliant_iso",
                    "enum": ["sample_calibration", "non_compliant_iso"]
                  },
                  "iso_standard": {
                    "type": "string",
                    "default": "ISO 9001:2015",
                    "description": "ISO standard to follow",
                    "example": "ISO 9001:2015"
                  },
                  "document_type": {
                    "type": "string",
                    "default": "quality_system_record",
                    "description": "Type of ISO document to generate",
                    "example": "quality_system_record"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Document processed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string"
                    },
                    "generated_template": {
                      "type": "string",
                      "description": "The complete ISO-compliant document template"
                    },
                    "document_type": {
                      "type": "string"
                    },
                    "iso_standard": {
                      "type": "string"
                    },
                    "extracted_fields": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "string"
                      },
                      "description": "Extracted fields - use these when chaining to checkQuality",
                      "example": {
                        "document_title": "Device Calibration Procedure",
                        "document_number": "CAL-001",
                        "department": "Quality Assurance"
                      }
                    },
                    "saved_file_path": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid document_id"
          },
          "500": {
            "description": "Server error during processing"
          }
        }
      }
    },
    "/api/v1/workflow-preloaded": {
      "post": {
        "operationId": "workflowPreloaded",
        "summary": "Complete workflow with pre-loaded document (BEST for Orchestrate)",
        "description": "Process a pre-loaded document through the COMPLETE workflow: parse, extract, generate ISO template, AND run quality checks - all in one!",
        "tags": ["Complete Workflow"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["document_id"],
                "properties": {
                  "document_id": {
                    "type": "string",
                    "description": "ID of pre-loaded document",
                    "example": "non_compliant_iso",
                    "enum": ["sample_calibration", "non_compliant_iso"]
                  },
                  "iso_standard": {
                    "type": "string",
                    "default": "ISO 9001:2015",
                    "description": "ISO standard to follow",
                    "example": "ISO 9001:2015"
                  },
                  "document_type": {
                    "type": "string",
                    "default": "quality_system_record",
                    "description": "Type of ISO document to generate",
                    "example": "quality_system_record"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Complete workflow executed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Complete workflow executed successfully with quality grade B"
                    },
                    "extracted_text": {
                      "type": "string",
                      "description": "Text extracted from document"
                    },
                    "document_metadata": {
                      "type": "object",
                      "description": "Document metadata (filename, size, etc.)"
                    },
                    "extracted_fields": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "string"
                      },
                      "description": "Dictionary of fields extracted from document"
                    },
                    "generated_template": {
                      "type": "string",
                      "description": "ISO-compliant template"
                    },
                    "document_type": {
                      "type": "string",
                      "description": "Type of document generated",
                      "example": "quality_system_record"
                    },
                    "iso_standard": {
                      "type": "string",
                      "description": "ISO standard followed",
                      "example": "ISO 9001:2015"
                    },
                    "quality_score": {
                      "type": "number",
                      "description": "Quality score (0-100)",
                      "example": 85.5
                    },
                    "quality_grade": {
                      "type": "string",
                      "description": "Quality grade (A, B, C, D, F)",
                      "example": "B"
                    },
                    "total_rules_checked": {
                      "type": "integer",
                      "description": "Total number of rules checked",
                      "example": 12
                    },
                    "rules_passed": {
                      "type": "integer",
                      "description": "Number of rules passed",
                      "example": 10
                    },
                    "rules_failed": {
                      "type": "integer",
                      "description": "Number of rules failed",
                      "example": 2
                    },
                    "violations": {
                      "type": "array",
                      "description": "List of quality rule violations",
                      "items": {
                        "type": "object",
                        "properties": {
                          "rule_id": {
                            "type": "string",
                            "example": "RULE_001"
                          },
                          "rule_name": {
                            "type": "string",
                            "example": "Department Field Required"
                          },
                          "severity": {
                            "type": "string",
                            "enum": ["error", "warning", "info"],
                            "example": "error"
                          },
                          "description": {
                            "type": "string",
                            "example": "Department field must be present"
                          },
                          "violation_details": {
                            "type": "string",
                            "example": "Department field not found in template"
                          },
                          "passed": {
                            "type": "boolean",
                            "example": false
                          }
                        }
                      }
                    },
                    "recommendations": {
                      "type": "array",
                      "description": "Recommendations for improvement",
                      "items": {
                        "type": "string"
                      }
                    },
                    "source_document": {
                      "type": "string",
                      "description": "Original document filename or identifier",
                      "example": "Pre-loaded: non_compliant_iso"
                    },
                    "timestamp": {
                      "type": "string",
                      "description": "Timestamp of processing (ISO 8601 format)",
                      "example": "2024-10-30T12:00:00.000000"
                    },
                    "saved_file_path": {
                      "type": "string",
                      "description": "Path to saved output file (null if not saved locally)",
                      "nullable": true,
                      "example": "outputs/complete_workflow_preloaded_non_compliant_iso_20241030_120000.json"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid document_id"
          },
          "500": {
            "description": "Server error during processing"
          }
        }
      }
    },
    "/api/v1/workflow-complete": {
      "post": {
        "operationId": "workflowComplete",
        "summary": "Complete workflow with file upload",
        "description": "Upload a document and execute the COMPLETE workflow: parse, extract, generate ISO template, AND run quality checks - all in one!",
        "tags": ["Complete Workflow"],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": ["file"],
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary",
                    "description": "Document file to process (DOCX, PDF, etc.)"
                  },
                  "iso_standard": {
                    "type": "string",
                    "default": "ISO 9001:2015",
                    "description": "ISO standard to follow",
                    "example": "ISO 9001:2015"
                  },
                  "document_type": {
                    "type": "string",
                    "default": "quality_system_record",
                    "description": "Type of ISO document to generate",
                    "example": "quality_system_record"
                  }
                }
              },
              "encoding": {
                "file": {
                  "contentType": "application/octet-stream"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Complete workflow executed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Complete workflow executed successfully with quality grade B"
                    },
                    "extracted_text": {
                      "type": "string",
                      "description": "Text extracted from document"
                    },
                    "document_metadata": {
                      "type": "object",
                      "description": "Document metadata (filename, size, etc.)"
                    },
                    "extracted_fields": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "string"
                      },
                      "description": "Dictionary of fields extracted from document"
                    },
                    "generated_template": {
                      "type": "string",
                      "description": "ISO-compliant template"
                    },
                    "document_type": {
                      "type": "string",
                      "description": "Type of document generated",
                      "example": "quality_system_record"
                    },
                    "iso_standard": {
                      "type": "string",
                      "description": "ISO standard followed",
                      "example": "ISO 9001:2015"
                    },
                    "quality_score": {
                      "type": "number",
                      "description": "Quality score (0-100)",
                      "example": 85.5
                    },
                    "quality_grade": {
                      "type": "string",
                      "description": "Quality grade (A, B, C, D, F)",
                      "example": "B"
                    },
                    "total_rules_checked": {
                      "type": "integer",
                      "description": "Total number of rules checked",
                      "example": 12
                    },
                    "rules_passed": {
                      "type": "integer",
                      "description": "Number of rules passed",
                      "example": 10
                    },
                    "rules_failed": {
                      "type": "integer",
                      "description": "Number of rules failed",
                      "example": 2
                    },
                    "violations": {
                      "type": "array",
                      "description": "List of quality rule violations",
                      "items": {
                        "type": "object",
                        "properties": {
                          "rule_id": {
                            "type": "string",
                            "example": "RULE_001"
                          },
                          "rule_name": {
                            "type": "string",
                            "example": "Department Field Required"
                          },
                          "severity": {
                            "type": "string",
                            "enum": ["error", "warning", "info"],
                            "example": "error"
                          },
                          "description": {
                            "type": "string",
                            "example": "Department field must be present"
                          },
                          "violation_details": {
                            "type": "string",
                            "example": "Department field not found in template"
                          },
                          "passed": {
                            "type": "boolean",
                            "example": false
                          }
                        }
                      }
                    },
                    "recommendations": {
                      "type": "array",
                      "description": "Recommendations for improvement",
                      "items": {
                        "type": "string"
                      }
                    },
                    "source_document": {
                      "type": "string",
                      "description": "Original document filename",
                      "example": "sample_document.docx"
                    },
                    "timestamp": {
                      "type": "string",
                      "description": "Timestamp of processing (ISO 8601 format)",
                      "example": "2024-10-30T12:00:00.000000"
                    },
                    "saved_file_path": {
                      "type": "string",
                      "description": "Path to saved output file (null if not saved locally)",
                      "nullable": true,
                      "example": "outputs/complete_workflow_quality_system_record_20241030_120000.json"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request - invalid file or parameters"
          },
          "500": {
            "description": "Server error during processing"
          }
        }
      }
    },
    "/api/v1/debug-upload": {
      "post": {
        "operationId": "debugUpload",
        "summary": "Debug file upload",
        "description": "Debug endpoint to test what Orchestrate is sending",
        "tags": ["System"],
        "requestBody": {
          "required": false,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary",
                    "description": "Test file"
                  },
                  "iso_standard": {
                    "type": "string",
                    "description": "Test ISO standard"
                  },
                  "document_type": {
                    "type": "string",
                    "description": "Test document type"
                  }
                }
              },
              "encoding": {
                "file": {
                  "contentType": "application/octet-stream"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Debug information",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/parse-document": {
      "post": {
        "operationId": "parseDocument",
        "summary": "Parse document",
        "description": "Upload a DOCX or PDF file and extract text content",
        "tags": ["Document Processing"],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": ["file"],
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary",
                    "description": "Document file to parse (DOCX, PDF, etc.)"
                  }
                }
              },
              "encoding": {
                "file": {
                  "contentType": "application/octet-stream"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Document parsed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Document parsed successfully"
                    },
                    "extracted_text": {
                      "type": "string",
                      "description": "Text extracted from the document"
                    },
                    "metadata": {
                      "type": "object",
                      "description": "Document metadata (filename, size, etc.)"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request - no file provided"
          },
          "500": {
            "description": "Server error during parsing"
          }
        }
      }
    },
    "/api/v1/extract-fields": {
      "post": {
        "operationId": "extractFields",
        "summary": "Extract fields from text",
        "description": "Use AI to extract specific fields from document text",
        "tags": ["Field Extraction"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["document_text"],
                "properties": {
                  "document_text": {
                    "type": "string",
                    "description": "The text content to extract fields from"
                  },
                  "fields_to_extract": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "default": [
                      "document_title",
                      "document_number",
                      "revision_number",
                      "effective_date",
                      "department",
                      "author",
                      "purpose",
                      "scope"
                    ],
                    "description": "List of field names to extract"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Fields extracted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Fields extracted successfully"
                    },
                    "extracted_fields": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "field_name": {
                            "type": "string",
                            "example": "document_title"
                          },
                          "value": {
                            "type": "string",
                            "example": "Quality System Procedure"
                          },
                          "confidence": {
                            "type": "number",
                            "example": 0.95
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/generate-iso-template": {
      "post": {
        "operationId": "generateISOTemplate",
        "summary": "Generate ISO template",
        "description": "Generate an ISO-compliant document template from extracted fields",
        "tags": ["ISO Template Generation"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["extracted_fields"],
                "properties": {
                  "document_type": {
                    "type": "string",
                    "default": "quality_system_record",
                    "description": "Type of ISO document to generate",
                    "example": "quality_system_record"
                  },
                  "extracted_fields": {
                    "type": "object",
                    "additionalProperties": {
                      "type": "string"
                    },
                    "description": "Dictionary of field names and their values",
                    "example": {
                      "document_title": "Quality System Procedure",
                      "document_number": "QSP-001",
                      "revision_number": "1.0"
                    }
                  },
                  "iso_standard": {
                    "type": "string",
                    "default": "ISO 9001:2015",
                    "description": "ISO standard to follow",
                    "example": "ISO 9001:2015"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "ISO template generated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "ISO template generated successfully"
                    },
                    "generated_template": {
                      "type": "string",
                      "description": "The complete ISO-compliant document template"
                    },
                    "document_type": {
                      "type": "string",
                      "example": "quality_system_record"
                    },
                    "iso_standard": {
                      "type": "string",
                      "example": "ISO 9001:2015"
                    },
                    "extracted_fields": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "string"
                      },
                      "description": "Extracted fields that were used to generate the template",
                      "example": {
                        "document_title": "Quality System Procedure",
                        "document_number": "QSP-001"
                      }
                    },
                    "saved_file_path": {
                      "type": "string",
                      "description": "Path where the output was saved"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/process-complete": {
      "post": {
        "operationId": "processComplete",
        "summary": "Complete pipeline (RECOMMENDED)",
        "description": "Upload a file and automatically parse, extract fields, and generate ISO template in one step",
        "tags": ["Complete Processing"],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": ["file"],
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary",
                    "description": "Document file to process (DOCX, PDF, etc.)"
                  },
                  "iso_standard": {
                    "type": "string",
                    "description": "ISO standard to follow",
                    "default": "ISO 9001:2015",
                    "example": "ISO 9001:2015"
                  },
                  "document_type": {
                    "type": "string",
                    "description": "Type of ISO document to generate",
                    "default": "quality_system_record",
                    "example": "quality_system_record"
                  }
                }
              },
              "encoding": {
                "file": {
                  "contentType": "application/octet-stream"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Complete processing successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Complete processing pipeline executed successfully"
                    },
                    "generated_template": {
                      "type": "string",
                      "description": "The complete ISO-compliant document template"
                    },
                    "document_type": {
                      "type": "string",
                      "example": "quality_system_record"
                    },
                    "iso_standard": {
                      "type": "string",
                      "example": "ISO 9001:2015"
                    },
                    "extracted_fields": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "string"
                      },
                      "description": "Extracted fields from the document - use these for quality checks",
                      "example": {
                        "document_title": "Device Calibration Procedure",
                        "document_number": "CAL-001",
                        "department": "Quality Assurance"
                      }
                    },
                    "saved_file_path": {
                      "type": "string",
                      "description": "Path where the output was saved"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request - invalid file or parameters"
          },
          "500": {
            "description": "Server error during processing"
          }
        }
      }
    },
    "/api/v1/check-quality": {
      "post": {
        "operationId": "checkQuality",
        "summary": "Check quality of ISO template",
        "description": "Validate a generated ISO template against quality rules using AI",
        "tags": ["Quality Assurance"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
            "schema": {
              "type": "object",
              "required": [
                "generated_template",
                "document_type",
                "iso_standard"
              ],
              "properties": {
                "generated_template": {
                  "type": "string",
                  "description": "The ISO template text to check"
                },
                "extracted_fields": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "string"
                  },
                  "description": "The fields used to generate the template (optional, defaults to empty object)",
                  "default": {}
                },
                  "document_type": {
                    "type": "string",
                    "example": "quality_system_record"
                  },
                  "iso_standard": {
                    "type": "string",
                    "example": "ISO 9001:2015"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Quality check completed",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Quality check completed with grade A"
                    },
                    "overall_score": {
                      "type": "number",
                      "description": "Overall quality score (0-100)",
                      "example": 95.5
                    },
                    "quality_grade": {
                      "type": "string",
                      "description": "Quality grade: A, B, C, D, or F",
                      "example": "A"
                    },
                    "total_rules_checked": {
                      "type": "integer",
                      "example": 10
                    },
                    "rules_passed": {
                      "type": "integer",
                      "example": 9
                    },
                    "rules_failed": {
                      "type": "integer",
                      "example": 1
                    },
                    "violations": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "rule_id": {
                            "type": "string",
                            "example": "RULE_001"
                          },
                          "rule_name": {
                            "type": "string",
                            "example": "Department Field Required"
                          },
                          "severity": {
                            "type": "string",
                            "enum": ["error", "warning", "info"],
                            "example": "error"
                          },
                          "description": {
                            "type": "string",
                            "example": "Department field must be present"
                          },
                          "violation_details": {
                            "type": "string",
                            "example": "Department field not found in template"
                          },
                          "passed": {
                            "type": "boolean",
                            "example": false
                          }
                        }
                      }
                    },
                    "recommendations": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "List of recommendations for improvement"
                    },
                    "saved_file_path": {
                      "type": "string",
                      "description": "Path to saved quality report"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "System",
      "description": "System health and status endpoints"
    },
    {
      "name": "Document Processing",
      "description": "Parse and extract text from documents"
    },
    {
      "name": "Field Extraction",
      "description": "Extract structured fields from text using AI"
    },
    {
      "name": "ISO Template Generation",
      "description": "Generate ISO-compliant document templates"
    },
    {
      "name": "Complete Processing",
      "description": "End-to-end document processing pipeline"
    },
    {
      "name": "Complete Workflow",
      "description": "Complete workflow with all steps including quality checks"
    },
    {
      "name": "Quality Assurance",
      "description": "Validate and check quality of generated templates"
    }
  ]
}

